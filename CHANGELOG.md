# Changelog

## [1.4.1] - 2023-XX-XX

### Добавлено
- **Страница "Хост не найден"**: Добавлена специальная страница для случаев, когда запрашиваемый хост отсутствует в конфигурации. Страница предоставляет пользователю инструкции по устранению проблемы, такие как проверка DNS или обращение к администратору.
- **Улучшенная обработка ошибок**: Добавлена поддержка более информативных сообщений об ошибках для пользователей и администраторов.
- **Динамическая перезагрузка конфигурации**: Улучшена обработка сигнала `SIGHUP` для перезагрузки конфигурации без перезапуска сервера.

### Исправлено
- Исправлена проблема с отсутствующей функцией `ConfigParser.Load`, добавлена реализация загрузки конфигурационного файла в формате INI.
- Исправлена работа WebSocket через безопасное соединение (`wss://`) при использовании HTTPS.
- Исправлена логика кэширования файлов: теперь учитываются изменения файлов на диске.
- Устранены потенциальные ошибки при инициализации логгера.
- Исправлена обработка некорректных заголовков CORS.
- Устранены проблемы с запуском Node.js приложений при неправильных путях.

### Изменено
- Обновлен метод `handleRequest` для интеграции новой страницы "Хост не найден".
- Переработан стек middleware для улучшения модульности и удобства поддержки.
- Улучшено логирование ключевых операций, таких как запуск, остановка сервера и перезагрузка конфигурации.

### Безопасность
- Добавлена защита от атак path traversal с использованием строгой валидации путей.
- Улучшена логика ограничения скорости запросов для предотвращения злоупотреблений.
- Настроено использование безопасных значений для заголовков `Content-Type` и `Content-Disposition`.

## [1.4] - 2025-05-02

### Добавлено
- **Правила перезаписи URL с условиями**:
  - Добавлена поддержка правил перезаписи URL с условиями, таких как проверка существования файлов (`if -f`) или других параметров.
  - Пример правила: `*.html if -f /path/to/file /new/path`.
- **Автоматический редирект HTTP → HTTPS**:
  - Реализован автоматический редирект с HTTP на HTTPS, если для хоста настроен SSL-сертификат.
- **Сохранение параметров запроса**:
  - Добавлена поддержка сохранения параметров запроса (`query string`) при выполнении правил перезаписи URL.
- **Расширенная система плагинов**:
  - Расширен интерфейс плагинов для поддержки более сложной логики обработки запросов.
  - Добавлены примеры плагинов для демонстрации возможностей системы.
- **Поддержка Razor Pages**:
  - Добавлена специальная поддержка .NET Razor Pages через новую директиву конфигурации `AppType=razorpages`.
- **Улучшенная обработка ошибок**:
  - Добавлены более информативные сообщения об ошибках для пользователей и администраторов.
- **Поддержка HTTP/3**:
  - Добавлена поддержка протокола HTTP/3 с использованием QUIC для улучшения производительности и безопасности.
  - HTTP/3 доступен на том же порту, что и HTTPS.

### Изменено
- **Оптимизация кода**:
  - Оптимизирована работа с кэшем для уменьшения задержек при обслуживании статических файлов.
  - Улучшена производительность middleware за счет минимизации блокировок.
- **Обработка конфигурационного файла**:
  - Улучшена обработка комментариев и пустых строк в конфигурационном файле.
  - Добавлена поддержка новых директив, таких как `AppType` и `RewriteRule`.
- **Логирование**:
  - Добавлены дополнительные поля в логи для упрощения отладки (например, `host`, `path`, `method`).
  - Улучшено форматирование JSON-логов для совместимости с системами сбора логов.
- **WebSocket**:
  - Добавлена возможность отправки широковещательных сообщений всем активным WebSocket-соединениям.

### Исправлено
- Исправлена проблема с неиспользуемой переменной `query` в коде обработки rewrite rules.
- Устранена утечка памяти при работе с большими файлами в кэше.
- Исправлена обработка некорректных заголовков CORS.
- Устранены ошибки при запуске Node.js приложений с неправильными путями.

### Удалено
- Удалены устаревшие функции для работы с прокси, замененные более эффективными решениями.
- Убраны неиспользуемые зависимости из `go.mod`.

### Безопасность
- Добавлена защита от атак path traversal с использованием строгой валидации путей.
- Улучшена обработка заголовков `Host` для предотвращения атак типа Host Header Injection.
- Настроено использование безопасных значений для заголовков `Content-Type` и `Content-Disposition`.

## [1.3] - 2025-04-27

### Добавлено
- **Защита от DDoS-атак**:
  - Добавлена защита от DDoS-атак с настраиваемыми параметрами, такими как максимальное количество запросов в секунду (`AntiDDoSMaxRequestsPerSecond`) и длительность блокировки (`AntiDDoSBlockDuration`).
  - Реализован механизм блокировки IP-адресов, превышающих допустимый лимит запросов.
- **Поддержка WebSocket**:
  - Добавлена поддержка WebSocket-соединений с возможностью обработки сообщений в реальном времени.
  - Реализован базовый эхо-сервер для тестирования WebSocket.
- **Динамическая перезагрузка конфигурации**:
  - Улучшена обработка сигнала `SIGHUP` для перезагрузки конфигурации без перезапуска сервера.
- **Логирование**:
  - Обновлен формат логов для более удобного анализа (JSON).
  - Добавлены уникальные идентификаторы запросов (`X-Request-ID`) для трассировки.
- **Ограничение скорости запросов**:
  - Добавлена поддержка настройки ограничения скорости запросов для каждого виртуального хоста.
- **Механизм fallback для SPA**:
  - Улучшен механизм fallback для Single Page Applications (SPA), позволяющий корректно обслуживать маршруты фронтенда.

### Изменено
- **Рефакторинг кода**:
  - Проведен рефакторинг кода для улучшения читаемости и поддержки.
  - Удалены неиспользуемые импорты и исправлены предупреждения компилятора.
- **Обработка конфигурации**:
  - Улучшена обработка ошибок при загрузке конфигурации.
  - Добавлена проверка корректности путей к файлам и директориям.
- **Middleware**:
  - Оптимизированы middleware для логирования, метрик и восстановления после паники.

### Исправлено
- Исправлена работа с путями файлов при использовании разных операционных систем (Windows/Linux).
- Устранены проблемы с лишними запятыми в логах и конфигурационных файлах.
- Исправлена обработка ошибок при загрузке SSL-сертификатов.

### Удалено
- Удалены устаревшие комментарии и неиспользуемые переменные.

### Безопасность
- Добавлена дополнительная проверка заголовков запросов для защиты от потенциальных атак.
- Улучшена обработка больших файлов и запросов для предотвращения переполнения памяти.

### Известные проблемы
- При высокой нагрузке возможны задержки в обработке запросов, если не настроены оптимальные параметры Anti-DDoS.
- Если файл конфигурации содержит ошибки, сервер может не запуститься. Убедитесь в корректности `.ini` файла перед запуском.
