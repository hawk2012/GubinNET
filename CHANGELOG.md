# Changelog

## [1.2] - 2025-04-21

### Added

- **Основная функциональность сервера**:
  - Реализована поддержка HTTP и HTTPS серверов с возможностью динамической загрузки SSL-сертификатов.
  - Добавлена поддержка проксирования запросов к внутренним приложениям (например, .NET и Node.js).
  - Внедрена система виртуальных хостов с возможностью настройки через конфигурационный файл `.ini`.
  - Добавлена поддержка статических файлов и SPA (Single Page Applications) с fallback-механизмом.
  - Реализован механизм ограничения скорости запросов (Rate Limiting) для защиты от злоупотреблений.
  - Добавлена базовая аутентификация (Basic Auth) для защиты ресурсов.
  - Поддержка CORS (Cross-Origin Resource Sharing) с настраиваемыми origin, методами и заголовками.

- **Логирование**:
  - Внедрена система логирования с поддержкой JSON-формата и уровнями логирования (`INFO`, `WARNING`, `ERROR`, `DEBUG`).

- **Метрики**:
  - Интеграция с Prometheus для мониторинга метрик, таких как количество запросов, их длительность и активные соединения.

- **Кэширование**:
  - Реализовано кэширование статических файлов с учетом времени модификации и ETag.

- **Сжатие**:
  - Добавлена поддержка Gzip-сжатия ответов для уменьшения объема передаваемых данных.

- **Загрузка конфигурации**:
  - Автоматическое создание закомментированного файла конфигурации `.ini`, если он отсутствует.
  - Возможность перезагрузки конфигурации без перезапуска сервера (SIGHUP).

- **Health Check**:
  - Добавлен эндпоинт `/health` для проверки работоспособности сервера.

- **Graceful Shutdown**:
  - Реализовано корректное завершение работы сервера с остановкой всех запущенных приложений (.NET, Node.js).

### Changed

- Улучшена обработка ошибок и добавлены middleware для логирования, метрик и восстановления после паники.
- Оптимизирована работа с файловой системой для обслуживания статических файлов.

### Fixed

- Исправлена обработка некорректных URL-путей (например, содержащих `../`).
- Устранены проблемы с определением реального IP-адреса клиента при использовании прокси.

### Removed

- Удалены неиспользуемые зависимости и устаревшие части кода.

### Security

- Добавлена защита от слишком больших запросов с помощью ограничения размера тела запроса (`MaxRequestSize`).
- Настроено использование TLS 1.2 и выше для HTTPS-соединений.

---

### Пример использования

```bash
# Запуск сервера
./gubinnet

# Проверка health check
curl http://localhost:8081/health

# Просмотр метрик Prometheus
curl http://localhost:9090/metrics
```

### Known Issues

- Если файл конфигурации содержит синтаксические ошибки, сервер может не запуститься. Убедитесь в корректности `.ini` файла.