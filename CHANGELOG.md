# Changelog

Все значимые изменения в проекте GubinNET будут задокументированы в этом файле.

---

## [1.5.1] - 2025-06-05

### Добавлено
1. **Обработка PHP-запросов через FastCGI**:
   - Реализована поддержка выполнения PHP-скриптов через FastCGI (по умолчанию на порту `9000`).
   - Добавлена проверка существования PHP-файлов перед их обработкой.
   - Реализован механизм копирования заголовков и ответов между клиентом и PHP-FPM.

2. **Устранение ошибки 500 для PHP-сайтов**:
   - Исправлена проблема с некорректной обработкой PHP-запросов, которая ранее вызывала ошибку 500.
   - Добавлены логи для диагностики ошибок при выполнении PHP-скриптов.

3. **Поддержка современных практик PHP 2025 года**:
   - Добавлена поддержка API-First архитектуры через конфигурацию `try_files`.
   - Реализована автоматическая маршрутизация запросов для Laravel-приложений (через `index.php`).

4. **Усиление безопасности**:
   - Добавлены механизмы защиты от SQL-инъекций и XSS-атак через middleware.
   - Реализована блокировка подозрительных запросов (например, `.env`, `/shell`).

5. **Оптимизация производительности**:
   - Добавлен механизм кэширования статических файлов для ускорения работы сервера.
   - Реализована поддержка Gzip-сжатия для текстовых файлов (HTML, CSS, JS).

6. **Горизонтальное масштабирование**:
   - Добавлена поддержка SNI (Server Name Indication) для работы с несколькими SSL-сертификатами на одном IP-адресе.

7. **Логирование и мониторинг**:
   - Улучшен формат логов для удобства анализа.
   - Добавлены уникальные идентификаторы запросов (`X-Request-ID`) для трассировки.
   - Интегрированы метрики Prometheus для мониторинга производительности сервера:
     - `http_requests_total`: Общее количество HTTP-запросов.
     - `http_request_duration_seconds`: Время обработки запросов.
     - `http_active_connections`: Количество активных соединений.

8. **Обработка ошибок**:
   - Добавлены страницы ошибок для различных ситуаций:
     - Страница "Host Not Found" для несуществующих хостов.
     - Страница "File Not Found" для отсутствующих файлов.
     - Страница "Access Denied" для заблокированных запросов.

9. **Горячая перезагрузка конфигурации**:
   - Реализована возможность перезагрузки конфигурации через сигнал `SIGHUP`.

---

### Изменено
1. **Структура конфигурации**:
   - Добавлены новые параметры для поддержки PHP и SSL:
     - `use_ssl`: Включение HTTPS.
     - `redirect_to_https`: Автоматическое перенаправление HTTP на HTTPS.
     - `proxy_url`: Поддержка проксирования запросов.

2. **Middleware**:
   - Переработаны middleware для более четкого разделения функционала:
     - `securityMiddleware`: Защита от подозрительных запросов.
     - `loggingMiddleware`: Логирование всех запросов.
     - `metricsMiddleware`: Сбор метрик для мониторинга.

3. **Кэширование файлов**:
   - Улучшен механизм кэширования статических файлов:
     - Добавлена проверка времени модификации файлов для обновления кэша.
     - Реализована поддержка `ETag` и `Last-Modified` заголовков.

4. **Обработка статических файлов**:
   - Улучшена логика поиска `index.html` в директориях.
   - Добавлена поддержка нескольких вариантов индексных файлов (`index.html`, `index.htm`, `default.htm`).

---

### Исправлено
1. **Проблемы с обработкой запросов**:
   - Исправлена ошибка, из-за которой сервер мог возвращать ошибку 500 при некорректной обработке PHP-запросов.
   - Устранена проблема с некорректным определением MIME-типов для статических файлов.

2. **Блокировка подозрительных запросов**:
   - Исправлена логика блокировки запросов, содержащих потенциально опасные шаблоны (например, `.env`, `/shell`).

3. **Перехват сигналов ОС**:
   - Исправлена обработка сигналов `SIGHUP`, `SIGTERM` и других для корректной перезагрузки и завершения работы сервера.

---

### Удалено
1. **Устаревшие методы**:
   - Удалены методы, которые больше не используются, например, `updateConfig` из структуры `VirtualHost`.

2. **Ненужные конфигурации**:
   - Очищены устаревшие или неиспользуемые параметры конфигурации для упрощения кодовой базы.

---

### Безопасность
1. **Защита от атак**:
   - Добавлены механизмы защиты от SQL-инъекций и XSS-атак.
   - Реализована блокировка подозрительных запросов через middleware.

2. **Минимальная версия TLS**:
   - Установлено ограничение на использование TLS версии 1.2 и выше для безопасных соединений.

3. **Отслеживание IP-адресов**:
   - Реализовано отслеживание IP-адресов для предотвращения DDoS-атак.

---

### Документация
1. **Комментарии в коде**:
   - Добавлены подробные комментарии для всех ключевых функций и методов.

2. **Руководство по конфигурации**:
   - Обновлено руководство по настройке сервера с учетом новых параметров и функциональности.
